<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Test Stream Creation</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 20px;
            }
            .form-group {
                margin-bottom: 15px;
            }
            label {
                display: block;
                margin-bottom: 5px;
            }
            input,
            select,
            textarea {
                width: 100%;
                padding: 8px;
                margin-bottom: 10px;
            }
            button {
                background: #007cba;
                color: white;
                padding: 10px 20px;
                border: none;
                cursor: pointer;
            }
            .error {
                color: red;
            }
            .success {
                color: green;
            }
        </style>
    </head>
    <body>
        <h1>Test Stream Creation Fix</h1>

        <form id="streamForm">
            <div class="form-group">
                <label>Title:</label>
                <input type="text" name="title" value="Test Stream" required />
            </div>

            <div class="form-group">
                <label>User ID:</label>
                <input type="number" name="user_id" value="3370" required />
                <small>Use the test user ID: 3370</small>
            </div>

            <div class="form-group">
                <label>Description:</label>
                <textarea name="description">Test stream description</textarea>
            </div>

            <div class="form-group">
                <label>Free Minutes:</label>
                <input type="number" name="free_minutes" value="5" required />
            </div>

            <div class="form-group">
                <label>Price:</label>
                <input type="number" name="price" value="0" step="0.01" />
            </div>

            <div class="form-group">
                <label>Currency:</label>
                <select name="currency">
                    <option value="NGN">NGN</option>
                    <option value="USD">USD</option>
                </select>
            </div>

            <div class="form-group">
                <label>Stream Type:</label>
                <select name="stream_type">
                    <option value="immediate">Immediate</option>
                    <option value="scheduled">Scheduled</option>
                </select>
            </div>

            <button type="submit">Create Stream</button>
        </form>

        <div id="result"></div>

        <script>
            document
                .getElementById("streamForm")
                .addEventListener("submit", async function (e) {
                    e.preventDefault();

                    const formData = new FormData(this);
                    const resultDiv = document.getElementById("result");

                    try {
                        const response = await fetch("/admin/streams", {
                            method: "POST",
                            body: formData,
                            headers: {
                                "X-CSRF-TOKEN": "test-token", // This would need to be real in actual usage
                            },
                        });

                        const data = await response.json();

                        if (data.success) {
                            resultDiv.innerHTML = `<div class="success">✅ Stream created successfully! Stream ID: ${data.data.id}</div>`;
                        } else {
                            resultDiv.innerHTML = `<div class="error">❌ Error: ${
                                data.message || "Unknown error"
                            }</div>`;
                        }
                    } catch (error) {
                        resultDiv.innerHTML = `<div class="error">❌ Network error: ${error.message}</div>`;
                    }
                });
        </script>
    </body>
</html>
