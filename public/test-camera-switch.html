<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Camera Switch Test - Debug</title>
        <script src="https://download.agora.io/sdk/release/AgoraRTC_N-4.18.0.js"></script>
    </head>
    <body>
        <h1>Camera Switch Debug Test</h1>

        <div>
            <h2>Test Live Stream</h2>
            <p>Stream ID: 20 - "FINAL TEST STREAM"</p>
            <p>Channel: final_test_1754043301</p>
            <p>User ID: 1 (Admin)</p>
        </div>

        <div>
            <h3>Quick Links:</h3>
            <ul>
                <li>
                    <a href="/admin/streams/20/broadcast" target="_blank"
                        >Broadcast Page (Admin)</a
                    >
                </li>
                <li>
                    <a href="/watch/1" target="_blank">Watch Page (Viewer)</a>
                </li>
                <li>
                    <a href="/api/streams/latest" target="_blank">API Check</a>
                </li>
            </ul>
        </div>

        <div>
            <h3>Test Instructions:</h3>
            <ol>
                <li>Open <strong>Broadcast Page</strong> in one tab</li>
                <li>Open <strong>Watch Page</strong> in another tab</li>
                <li>Start broadcasting from admin page</li>
                <li>Join stream from watch page</li>
                <li>Switch cameras on broadcast page</li>
                <li>Check if viewer page hangs or continues smoothly</li>
            </ol>
        </div>

        <div>
            <h3>Expected Behavior After Fix:</h3>
            <ul>
                <li>
                    âœ… Camera switch should show "Switching camera..." message
                    briefly
                </li>
                <li>
                    âœ… Video should resume with new camera within 2-3 seconds
                </li>
                <li>âœ… No hanging or frozen video</li>
                <li>âœ… Screen share should work smoothly (as before)</li>
                <li>
                    âœ… <strong>NEW:</strong> No
                    "CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS" error
                </li>
                <li>
                    âœ… <strong>NEW:</strong> Camera buttons disabled during
                    switch to prevent conflicts
                </li>
                <li>
                    âœ… <strong>NEW:</strong> Camera dropdown shows
                    "Switching..." state
                </li>
            </ul>
        </div>

        <div>
            <h3>Console Logs to Watch:</h3>
            <ul>
                <li>
                    <strong>Broadcast Page:</strong> "Old video track
                    unpublished successfully", "New video track published
                    successfully"
                </li>
                <li>
                    <strong>Watch Page:</strong> "User unpublished: likely
                    camera switch", "Reusing existing container for camera
                    switch"
                </li>
                <li>
                    <strong>NEW:</strong> "Camera switch already in progress,
                    ignoring request" (if clicking too fast)
                </li>
            </ul>
        </div>

        <div>
            <h3>ðŸ”§ Recent Fix Applied:</h3>
            <ul>
                <li>
                    <strong>Problem:</strong>
                    "CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS" error during camera
                    switching
                </li>
                <li>
                    <strong>Root Cause:</strong> Attempting to publish new video
                    track before old one was fully unpublished
                </li>
                <li>
                    <strong>Solution:</strong> Sequential track management with
                    proper timing and locking mechanism
                </li>
                <li>
                    <strong>Result:</strong> Smooth camera switching without
                    Agora conflicts
                </li>
            </ul>
        </div>

        <style>
            body {
                font-family: Arial, sans-serif;
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
                background: #f5f5f5;
            }

            div {
                background: white;
                padding: 15px;
                margin: 10px 0;
                border-radius: 5px;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            }

            h1,
            h2,
            h3 {
                color: #333;
            }

            a {
                color: #007bff;
                text-decoration: none;
            }

            a:hover {
                text-decoration: underline;
            }

            .status {
                padding: 5px 10px;
                border-radius: 3px;
                display: inline-block;
                margin: 5px 0;
            }

            .success {
                background: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }
        </style>
    </body>
</html>
